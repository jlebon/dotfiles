[merge]
	conflictstyle=zdiff3
[user]
	name = Jonathan Lebon
	email = jonathan@jlebon.com
[alias]
	# if we're in a git repo already, make sure to cd into the subdir first (aliases
	# always run from the root of the repo)
	initadd = "!set -e; f() { cd ${GIT_PREFIX:-.}; git init .; git add -A; git commit -m 'initial commit'; }; f"
	lsb = "!f() { : git branch; git bstatus \"$@\"; }; f"
	format-one-patch = "!f() { : git format-patch; git format-patch ${1}^..${1} \"$@\"; }; f"
	d = diff
	wip = commit -am "wip"
	scrap = reset --hard HEAD
	rob = reset HEAD^
	nuke = reset --hard HEAD^
	ck = checkout
	amend = commit --amend
	amendpipe = -c core.commentchar=| commit --amend
	amendit = commit --amend --no-edit
	fix = commit --amend --no-edit -a
	fixup = "!f() { : git commit; git commit -a --fixup ${1:-HEAD}; }; f"
	cm = "!set -e; git checkout $(git default)"
	clip = "!f() { : git log; git log -1 --format=%B ${1:-HEAD} | wl-copy; }; f"
	clipout = "!f() { : git log; git log -1 --format=%B ${1:-HEAD}; }; f"
	mfetch = "!set -e; r=$(git default -u); b=$(git default); git fetch $r $b:$b"
	rem = "!set -e; r=$(git default -u); b=$(git default); git rebase $b -i \"$@\""
	frem = "!set -e; git mfetch; git rem \"$@\""
	rec = "!f() { git up && git rebase --continue; }; f"
	rea = rebase --abort
	cp = cherry-pick
	cpc = cherry-pick --continue
	cpa = cherry-pick --abort
	cps = cherry-pick --skip
	l = log --pretty=oneline
	la = log --pretty=format:'%C(yellow)%h %Cred%ad %Cblue%an%Cgreen%d %Creset%s' --date=short
	lg = log --graph --pretty=format:'%C(yellow)%h %Cred%ad %Cblue%an%Cgreen%d %Creset%s' --date=short
	# I use this from hx's `pipe` command.
	quote = "!f() { : git log; xargs git log -n 1 --pretty=format:'%h (\"%s\")'; }; f"
	lgi = "!f() { : git log; git log-interactive \"$@\"; }; f"
	lai = "!f() { : git log; NO_GRAPH=1 git log-interactive \"$@\"; }; f"
	up = add -u
	bi = branch-interactive

	# same as git stash show, except you can just give the stash index number
	# defaults to git stash list if no index number given
	# also shows untracked stashed files (if any), which are kept in the third parent of the commit
	stashow = "!f() { set -e; if [ $# -eq 0 ]; then git stash list; else ( git show --color=always stash@{$1}; if git rev-parse --verify --quiet stash@{$1}^3; then git ow --color=always stash@{$1}^3; fi; ) | LESS=FRX less -r; fi; }; f"

	prd = "!f() { : git branch ; set -e; remote=$(git default -f); while [ $# -ne 0 ]; do b=$1; shift; git branch -D $b || :; git push $remote :pr/$b || :; done;}; f"
	pr = "!f() { : git push ; set -e; remote=$(git default -f); pr=$(git rev-parse --abbrev-ref ${BRANCH:-HEAD}); git push \"$@\" $remote ${BRANCH:-HEAD}:refs/heads/pr/$pr; }; f"
	prx = "!f() { : git branch ; \
		set -e; \
		branches=(); \
		for arg in \"$@\"; do \
			if [[ $arg = -* ]]; then \
				[ $arg != -- ] || shift; \
				break; \
			fi; \
			branches+=($arg); \
		done; \
		shift ${#branches[@]}; \
		for branch in \"${branches[@]}\"; do \
			BRANCH=$branch git pr \"$@\"; done; \
		}; f"

	restamp = "! git commit --amend --no-edit --date=\"$(date -R)\""

	subu = submodule update --init --recursive
	autosquash = -c core.editor=true rebase -i --autosquash
	# adapted from https://github.com/cgwalters/homegit/blob/master/dotfiles/gitconfig
	rclean = !git clean -dffX && git submodule foreach git clean -dffX
	rxclean = !git clean -dffx && git submodule foreach git clean -dffx
	willadd = add -N
	wa = worktree add
	wl = worktree list
	wp = worktree prune
	wn = "!f() { rm -rf worktrees; git worktree prune; }; f"
	wr = worktree remove

	# Difftastic aliases, so `git dlog` is `git log` with difftastic and so on.
	# dlog = -c diff.external=difft log --ext-diff
	# dshow = -c diff.external=difft show --ext-diff
	# ddiff = -c diff.external=difft diff
[pull]
	rebase = true
[fetch]
	prune = true
[push]
	default = simple
	autoSetupRemote = true
[diff]
    # external = difft
	algorithm = histogram
	renames = copies
	indentHeuristic = true
	compactionHeuristic = true
[include]
	path = .gitconfig.local
[commit]
	verbose = true
[core]
	pager = delta
	# commentchar = |
[interactive]
	diffFilter = delta --color-only
[delta]
	light = true
	navigate = true # use n and N to move between diff sections
	file-decoration-style = blue box bold
	hunk-header-decoration-style = hidden
	hunk-header-line-number-style = red bold
	hunk-header-style = line-number syntax bold ul
[rebase]
	autostash = true
	updateRefs = true
[grep]
	lineNumber = true
[init]
	templateDir = ~/.git_templates
	defaultBranch = main
[advice]
	skippedCherryPicks = false
[rerere]
	enabled = true
[branch]
	sort = -committerdate
# signing related
[user]
	signingKey = /var/home/jlebon/.ssh/id_rsa.flux.pub
[commit]
	gpgsign = true
[gpg]
	format = ssh
[safe]
	directory = *
